timeOff.controller('locationsController',
	['$scope', '$rootScope', 'CheckIfAdmin', 'Authentication', '$filter', '$firebaseArray', '$firebaseObject', 'FIREBASE_URL', 'Locations', 'ErrorSuccessClass',  
	function ($scope, $rootScope, CheckIfAdmin, Authentication, $filter, $firebaseArray, $firebaseObject, FIREBASE_URL, Locations, ErrorSuccessClass) {
		
		CheckIfAdmin();
		
		function capitalizeEachWord(str) {
			if(str!=null)
			return str.replace(/\w\S*/g, function(txt){
				return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
			}); 
		}
		
		$rootScope.pageName = "locationslist";
		
		$scope.message = null;
		$scope.characters = 30;
		$scope.locationslist = Locations;
		
		$scope.addLocation = function() {
			var locationsInfo = Locations;
			
			var myData = {
				locationName: capitalizeEachWord($scope.location.name),
				date: Firebase.ServerValue.TIMESTAMP
			};
	
			locationsInfo.$add(myData).then(function() {
				$scope.message = "New location " + myData.locationName + " was added succesfully";
				$scope.location.name = null;
			}).catch(function(error) {
				$scope.message = "There was a problem adding location";
			});
		};
		
		
		$scope.deleteLocation = function(location) {
			var confirmation = confirm("Do you really want to delete " + location.locationName + " ?");
			if(confirmation == true) {
				var refDel = new Firebase(FIREBASE_URL + 'locations/' + location.$id);
				var record = $firebaseObject(refDel);
				record.$remove(location.$id).then(function() {
					$scope.message = $filter('uppercase')(location.locationName) + " was removed from the system.";
				});
			} else {
				return;
			}
			
		};
}]);